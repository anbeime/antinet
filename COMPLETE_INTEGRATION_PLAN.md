# ğŸš€ Antinet å®Œæ•´åŠŸèƒ½é›†æˆæ–¹æ¡ˆ

## ğŸ“‹ æ¨èæŠ€æœ¯æ ˆ

### æ ¸å¿ƒç»„ä»¶

| åŠŸèƒ½æ¨¡å— | æ¨èå·¥å…· | ç”¨é€” | çŠ¶æ€ |
|---------|---------|------|------|
| **è¯­éŸ³è¯†åˆ«** | Faster-Whisper | è¯­éŸ³â†’æ–‡å­— | æ¨è |
| **è¯­éŸ³åˆæˆ** | Coqui TTS | æ–‡å­—â†’è¯­éŸ³ | æ¨è |
| **PPTç”Ÿæˆ** | pptx-generator | JSONâ†’PPTX | æ¨è |
| **PPTè§„åˆ’** | ppt-generator | æ™ºèƒ½å†…å®¹è§„åˆ’ | æ¨è |
| **PPTè§†è§‰** | nanobanana-ppt-visualizer | è§†è§‰å¢å¼º | æ¨è |
| **çŸ¥è¯†åº“** | Antinet ç°æœ‰ | å››è‰²å¡ç‰‡çŸ¥è¯†åº“ | å·²æœ‰ |
| **NPUæ¨ç†** | QNN + Qwen2-7B | ç«¯ä¾§AI | å·²æœ‰ |

---

## ğŸ¯ å®Œæ•´åŠŸèƒ½æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Antinet æ™ºèƒ½çŸ¥è¯†ç®¡å®¶                      â”‚
â”‚                  å®Œæ•´åŠŸèƒ½é›†æˆæ¶æ„å›¾                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è¾“å…¥å±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–‡å­—è¾“å…¥  â”‚  è¯­éŸ³è¾“å…¥(Faster-Whisper)  â”‚  æ–‡ä»¶ä¸Šä¼          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤„ç†å±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ NPUæ¨ç† (Qwen2-7B)                                        â”‚
â”‚  â€¢ çŸ¥è¯†åº“æŸ¥è¯¢ (å››è‰²å¡ç‰‡)                                      â”‚
â”‚  â€¢ æ•°æ®åˆ†æ                                                  â”‚
â”‚  â€¢ å†…å®¹ç”Ÿæˆ                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è¾“å‡ºå±‚                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ–‡å­—å›ç­”  â”‚  è¯­éŸ³å›ç­”(Coqui TTS)  â”‚  PPTæ–‡æ¡£  â”‚  å¯è§†åŒ–   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ è¯¦ç»†é›†æˆæ–¹æ¡ˆ

### é˜¶æ®µ1: åŸºç¡€é›†æˆï¼ˆ1-2å¤©ï¼‰

#### 1.1 å®‰è£…æ‰€æœ‰ä¾èµ–

```cmd
cd C:\test\antinet
venv_arm64\Scripts\activate

# è¯­éŸ³åŠŸèƒ½
pip install faster-whisper TTS

# PPTåŠŸèƒ½ï¼ˆå·²æœ‰python-pptxï¼Œè¡¥å……å…¶ä»–ï¼‰
pip install pillow openpyxl python-dotenv

# å…¶ä»–å¯é€‰
pip install moviepy pydub  # å¦‚æœéœ€è¦è§†é¢‘åŠŸèƒ½
```

#### 1.2 å¤åˆ¶PPTæŠ€èƒ½

```cmd
cd C:\test\antinet
integrate_new_ppt_skills.bat
```

#### 1.3 åˆ›å»ºç»Ÿä¸€æœåŠ¡ç›®å½•

```
backend/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ voice_service.py          # è¯­éŸ³æœåŠ¡ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ advanced_ppt_service.py   # PPTæœåŠ¡ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ chat_service.py           # èŠå¤©æœåŠ¡ï¼ˆå·²æœ‰ï¼‰
â”‚   â””â”€â”€ npu_service.py            # NPUæœåŠ¡ï¼ˆå·²æœ‰ï¼‰
â”œâ”€â”€ skills/
â”‚   â”œâ”€â”€ pptx-generator/           # PPTæŠ€èƒ½
â”‚   â”œâ”€â”€ ppt-generator/
â”‚   â”œâ”€â”€ nanobanana-ppt-visualizer/
â”‚   â””â”€â”€ local_audio_processor.py  # æœ¬åœ°éŸ³é¢‘å¤„ç†
â””â”€â”€ routes/
    â”œâ”€â”€ voice_routes.py           # è¯­éŸ³è·¯ç”±ï¼ˆæ–°å¢ï¼‰
    â”œâ”€â”€ ppt_routes.py             # PPTè·¯ç”±ï¼ˆæ›´æ–°ï¼‰
    â””â”€â”€ chat_routes.py            # èŠå¤©è·¯ç”±ï¼ˆå·²æœ‰ï¼‰
```

---

### é˜¶æ®µ2: è¯­éŸ³åŠŸèƒ½é›†æˆï¼ˆ2-3å¤©ï¼‰

#### 2.1 åˆ›å»ºè¯­éŸ³æœåŠ¡

åˆ›å»º `backend/services/voice_service.py`ï¼š

```python
"""
è¯­éŸ³æœåŠ¡
é›†æˆ Faster-Whisper (ASR) å’Œ Coqui TTS (TTS)
"""
from faster_whisper import WhisperModel
from TTS.api import TTS
from pathlib import Path
import time
from typing import Optional, Dict, Any

class VoiceService:
    """ç»Ÿä¸€çš„è¯­éŸ³æœåŠ¡"""
    
    def __init__(
        self,
        whisper_model: str = "base",
        tts_model: str = "tts_models/zh-CN/baker/tacotron2-DDC-GST"
    ):
        """
        åˆå§‹åŒ–è¯­éŸ³æœåŠ¡
        
        Args:
            whisper_model: Whisperæ¨¡å‹å¤§å°ï¼ˆtiny/base/small/medium/largeï¼‰
            tts_model: TTSæ¨¡å‹åç§°
        """
        print("[VoiceService] åˆå§‹åŒ–ä¸­...")
        
        # åˆå§‹åŒ–ASRï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰
        print(f"[VoiceService] åŠ è½½Whisperæ¨¡å‹: {whisper_model}")
        self.asr = WhisperModel(
            whisper_model,
            device="cpu",
            compute_type="int8"
        )
        
        # åˆå§‹åŒ–TTSï¼ˆè¯­éŸ³åˆæˆï¼‰
        print(f"[VoiceService] åŠ è½½TTSæ¨¡å‹: {tts_model}")
        self.tts = TTS(model_name=tts_model)
        
        print("[VoiceService] âœ“ åˆå§‹åŒ–å®Œæˆ")
    
    def speech_to_text(
        self,
        audio_path: str,
        language: str = "zh"
    ) -> Dict[str, Any]:
        """
        è¯­éŸ³è½¬æ–‡å­—
        
        Args:
            audio_path: éŸ³é¢‘æ–‡ä»¶è·¯å¾„
            language: è¯­è¨€ä»£ç ï¼ˆzh/enï¼‰
        
        Returns:
            {
                "text": "è¯†åˆ«çš„æ–‡å­—",
                "segments": [{"start": 0.0, "end": 1.5, "text": "..."}]
            }
        """
        print(f"[VoiceService] è¯†åˆ«è¯­éŸ³: {audio_path}")
        
        segments, info = self.asr.transcribe(
            audio_path,
            language=language,
            beam_size=5
        )
        
        # æ”¶é›†æ‰€æœ‰ç‰‡æ®µ
        all_segments = []
        text_parts = []
        
        for segment in segments:
            all_segments.append({
                "start": segment.start,
                "end": segment.end,
                "text": segment.text
            })
            text_parts.append(segment.text)
        
        full_text = " ".join(text_parts)
        
        print(f"[VoiceService] è¯†åˆ«ç»“æœ: {full_text[:50]}...")
        
        return {
            "text": full_text,
            "segments": all_segments,
            "language": info.language,
            "duration": info.duration
        }
    
    def text_to_speech(
        self,
        text: str,
        output_path: Optional[str] = None
    ) -> str:
        """
        æ–‡å­—è½¬è¯­éŸ³
        
        Args:
            text: è¦è½¬æ¢çš„æ–‡å­—
            output_path: è¾“å‡ºè·¯å¾„ï¼ˆå¯é€‰ï¼‰
        
        Returns:
            è¯­éŸ³æ–‡ä»¶è·¯å¾„
        """
        if output_path is None:
            output_dir = Path("output/voice")
            output_dir.mkdir(parents=True, exist_ok=True)
            output_path = str(output_dir / f"tts_{int(time.time())}.wav")
        
        print(f"[VoiceService] ç”Ÿæˆè¯­éŸ³: {text[:50]}...")
        
        self.tts.tts_to_file(
            text=text,
            file_path=output_path
        )
        
        print(f"[VoiceService] è¯­éŸ³å·²ä¿å­˜: {output_path}")
        return output_path
    
    def voice_dialogue(
        self,
        audio_path: str,
        chat_service
    ) -> Dict[str, Any]:
        """
        å®Œæ•´çš„è¯­éŸ³å¯¹è¯
        
        Args:
            audio_path: ç”¨æˆ·å½•éŸ³æ–‡ä»¶
            chat_service: èŠå¤©æœåŠ¡å®ä¾‹
        
        Returns:
            {
                "user_text": "ç”¨æˆ·è¯´çš„è¯",
                "assistant_text": "åŠ©æ‰‹å›ç­”",
                "assistant_audio": "è¯­éŸ³æ–‡ä»¶è·¯å¾„",
                "sources": "çŸ¥è¯†æ¥æº"
            }
        """
        # 1. è¯­éŸ³è¯†åˆ«
        asr_result = self.speech_to_text(audio_path)
        user_text = asr_result["text"]
        
        # 2. æŸ¥è¯¢çŸ¥è¯†åº“
        response = chat_service.query(user_text, [])
        assistant_text = response['response']
        sources = response.get('sources', [])
        
        # 3. è¯­éŸ³åˆæˆ
        assistant_audio = self.text_to_speech(assistant_text)
        
        return {
            "user_text": user_text,
            "assistant_text": assistant_text,
            "assistant_audio": assistant_audio,
            "sources": sources
        }


# å…¨å±€å•ä¾‹
_voice_service = None

def get_voice_service() -> VoiceService:
    """è·å–è¯­éŸ³æœåŠ¡å•ä¾‹"""
    global _voice_service
    if _voice_service is None:
        _voice_service = VoiceService()
    return _voice_service
```

#### 2.2 åˆ›å»ºè¯­éŸ³è·¯ç”±

åˆ›å»º `backend/routes/voice_routes.py`ï¼š

```python
"""
è¯­éŸ³åŠŸèƒ½è·¯ç”±
æä¾›è¯­éŸ³è¯†åˆ«ã€è¯­éŸ³åˆæˆã€è¯­éŸ³å¯¹è¯ç­‰API
"""
from fastapi import APIRouter, UploadFile, File, HTTPException
from pydantic import BaseModel
from typing import Optional
import os
import time

from backend.services.voice_service import get_voice_service
from backend.routes.chat_routes import chatService

router = APIRouter(prefix="/api/voice", tags=["è¯­éŸ³åŠŸèƒ½"])

class TextToSpeechRequest(BaseModel):
    """æ–‡å­—è½¬è¯­éŸ³è¯·æ±‚"""
    text: str
    output_path: Optional[str] = None

class SpeechToTextResponse(BaseModel):
    """è¯­éŸ³è½¬æ–‡å­—å“åº”"""
    text: str
    segments: list
    language: str
    duration: float

class VoiceDialogueResponse(BaseModel):
    """è¯­éŸ³å¯¹è¯å“åº”"""
    user_text: str
    assistant_text: str
    assistant_audio: str
    sources: list


@router.post("/speech-to-text", response_model=SpeechToTextResponse)
async def speech_to_text(file: UploadFile = File(...)):
    """
    è¯­éŸ³è½¬æ–‡å­—
    ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ï¼Œè¿”å›è¯†åˆ«çš„æ–‡å­—
    """
    try:
        # ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶
        temp_path = f"temp/audio_{int(time.time())}_{file.filename}"
        os.makedirs("temp", exist_ok=True)
        
        with open(temp_path, "wb") as f:
            content = await file.read()
            f.write(content)
        
        # è¯­éŸ³è¯†åˆ«
        voice_service = get_voice_service()
        result = voice_service.speech_to_text(temp_path)
        
        # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        os.remove(temp_path)
        
        return result
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))


@router.post("/text-to-speech")
async def text_to_speech(request: TextToSpeechRequest):
    """
    æ–‡å­—è½¬è¯­éŸ³
    è¾“å…¥æ–‡å­—ï¼Œè¿”å›è¯­éŸ³æ–‡ä»¶è·¯å¾„
    """
    try:
        voice_service = get_voice_service()
        audio_path = voice_service.text_to_speech(
            text=request.text,
            output_path=request.output_path
        )
        
        return {
            "audio_path": audio_path,
            "text": request.text
        }
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))


@router.post("/dialogue", response_model=VoiceDialogueResponse)
async def voice_dialogue(file: UploadFile = File(...)):
    """
    è¯­éŸ³å¯¹è¯
    ä¸Šä¼ ç”¨æˆ·å½•éŸ³ï¼Œè¿”å›æ–‡å­—å›ç­”å’Œè¯­éŸ³å›ç­”
    """
    try:
        # ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶
        temp_path = f"temp/dialogue_{int(time.time())}_{file.filename}"
        os.makedirs("temp", exist_ok=True)
        
        with open(temp_path, "wb") as f:
            content = await file.read()
            f.write(content)
        
        # å®Œæ•´å¯¹è¯æµç¨‹
        voice_service = get_voice_service()
        result = voice_service.voice_dialogue(temp_path, chatService)
        
        # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
        os.remove(temp_path)
        
        return result
        
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))


@router.get("/health")
async def voice_health():
    """è¯­éŸ³æœåŠ¡å¥åº·æ£€æŸ¥"""
    try:
        voice_service = get_voice_service()
        return {
            "status": "healthy",
            "asr": "faster-whisper",
            "tts": "coqui-tts"
        }
    except Exception as e:
        return {
            "status": "unhealthy",
            "error": str(e)
        }
```

---

### é˜¶æ®µ3: PPTåŠŸèƒ½é›†æˆï¼ˆ2-3å¤©ï¼‰

#### 3.1 åˆ›å»ºé«˜çº§PPTæœåŠ¡

åˆ›å»º `backend/services/advanced_ppt_service.py`ï¼š

```python
"""
é«˜çº§PPTæœåŠ¡
é›†æˆ pptx-generatorã€ppt-generatorã€nanobanana-ppt-visualizer
"""
import os
import sys
import json
import subprocess
from pathlib import Path
from typing import Dict, List, Any, Optional

class AdvancedPPTService:
    """é«˜çº§PPTæœåŠ¡"""
    
    def __init__(self):
        self.skills_dir = Path(__file__).parent.parent / "skills"
        self.pptx_generator = self.skills_dir / "pptx-generator"
        self.ppt_generator = self.skills_dir / "ppt-generator"
        self.visualizer = self.skills_dir / "nanobanana-ppt-visualizer"
    
    def create_ppt_from_topic(
        self,
        topic: str,
        pages: int = 10,
        style: str = "modern"
    ) -> Dict[str, Any]:
        """
        ä»ä¸»é¢˜åˆ›å»ºPPTï¼ˆå®Œæ•´æµç¨‹ï¼‰
        
        Args:
            topic: PPTä¸»é¢˜
            pages: é¡µæ•°
            style: æ ·å¼ï¼ˆbusiness/minimal/modernï¼‰
        
        Returns:
            {
                "json_data": PPT JSONæ•°æ®,
                "pptx_path": PPTXæ–‡ä»¶è·¯å¾„
            }
        """
        # 1. ä½¿ç”¨ppt-generatorç”Ÿæˆå†…å®¹ï¼ˆè¿™é‡Œç®€åŒ–ä¸ºç¤ºä¾‹ï¼‰
        json_data = self._generate_content(topic, pages)
        
        # 2. ä½¿ç”¨pptx-generatorè½¬æ¢ä¸ºPPTX
        pptx_path = self.json_to_pptx(json_data, style)
        
        return {
            "json_data": json_data,
            "pptx_path": pptx_path
        }
    
    def _generate_content(self, topic: str, pages: int) -> Dict[str, Any]:
        """
        ç”ŸæˆPPTå†…å®¹ï¼ˆç®€åŒ–ç‰ˆï¼‰
        å®é™…åº”è¯¥è°ƒç”¨ppt-generatorçš„ä¸ƒè§’è‰²åä½œæµç¨‹
        """
        # ç¤ºä¾‹JSONç»“æ„
        json_data = {
            "metadata": {
                "title": topic,
                "author": "Antinet",
                "theme": "modern"
            },
            "slides": []
        }
        
        # ç”Ÿæˆå¹»ç¯ç‰‡
        for i in range(pages):
            if i == 0:
                # å°é¢
                slide = {
                    "layout": "title",
                    "title": topic,
                    "subtitle": "ç”±Antinetæ™ºèƒ½çŸ¥è¯†ç®¡å®¶ç”Ÿæˆ"
                }
            else:
                # å†…å®¹é¡µ
                slide = {
                    "layout": "content",
                    "title": f"ç¬¬{i}éƒ¨åˆ†",
                    "content": [
                        f"è¦ç‚¹ {i}.1",
                        f"è¦ç‚¹ {i}.2",
                        f"è¦ç‚¹ {i}.3"
                    ]
                }
            
            json_data["slides"].append(slide)
        
        return json_data
    
    def json_to_pptx(
        self,
        json_data: Dict[str, Any],
        style: str = "modern",
        output_path: Optional[str] = None
    ) -> str:
        """
        JSONè½¬PPTX
        
        Args:
            json_data: PPT JSONæ•°æ®
            style: æ ·å¼
            output_path: è¾“å‡ºè·¯å¾„
        
        Returns:
            PPTXæ–‡ä»¶è·¯å¾„
        """
        import tempfile
        
        if output_path is None:
            output_dir = Path("output/ppt")
            output_dir.mkdir(parents=True, exist_ok=True)
            output_path = str(output_dir / f"presentation_{int(time.time())}.pptx")
        
        # ä¿å­˜JSONåˆ°ä¸´æ—¶æ–‡ä»¶
        with tempfile.NamedTemporaryFile(
            mode='w',
            suffix='.json',
            delete=False,
            encoding='utf-8'
        ) as f:
            json.dump(json_data, f, ensure_ascii=False)
            json_path = f.name
        
        # è°ƒç”¨pptx_builder.py
        script_path = self.pptx_generator / "scripts" / "pptx_builder.py"
        style_path = self.pptx_generator / "assets" / "styles" / f"{style}.json"
        
        try:
            subprocess.run([
                sys.executable,
                str(script_path),
                "--input", json_path,
                "--style", str(style_path),
                "--output", output_path
            ], check=True, capture_output=True, text=True)
            
            print(f"[PPTService] PPTXå·²ç”Ÿæˆ: {output_path}")
            return output_path
            
        finally:
            # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
            if os.path.exists(json_path):
                os.remove(json_path)
    
    def enhance_visuals(
        self,
        json_data: Dict[str, Any],
        style: str = "gradient-glass"
    ) -> Dict[str, Any]:
        """
        ä½¿ç”¨nanobanana-ppt-visualizerå¢å¼ºè§†è§‰
        
        Args:
            json_data: PPT JSONæ•°æ®
            style: è§†è§‰é£æ ¼
        
        Returns:
            å¢å¼ºåçš„JSONæ•°æ®
        """
        # TODO: å®ç°è§†è§‰å¢å¼ºé€»è¾‘
        return json_data


# å…¨å±€å•ä¾‹
_ppt_service = None

def get_ppt_service() -> AdvancedPPTService:
    """è·å–PPTæœåŠ¡å•ä¾‹"""
    global _ppt_service
    if _ppt_service is None:
        _ppt_service = AdvancedPPTService()
    return _ppt_service
```

#### 3.2 æ›´æ–°PPTè·¯ç”±

æ›´æ–° `backend/routes/ppt_routes.py`ï¼Œæ·»åŠ æ–°çš„APIç«¯ç‚¹ï¼š

```python
from backend.services.advanced_ppt_service import get_ppt_service

@router.post("/api/ppt/create-from-topic")
async def create_ppt_from_topic(request: CreatePPTRequest):
    """
    ä»ä¸»é¢˜åˆ›å»ºPPT
    ä½¿ç”¨å®Œæ•´çš„PPTç”Ÿæˆæµç¨‹
    """
    try:
        ppt_service = get_ppt_service()
        result = ppt_service.create_ppt_from_topic(
            topic=request.topic,
            pages=request.pages,
            style=request.style
        )
        return result
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@router.post("/api/ppt/json-to-pptx")
async def json_to_pptx(request: JSONToPPTXRequest):
    """
    JSONè½¬PPTX
    """
    try:
        ppt_service = get_ppt_service()
        pptx_path = ppt_service.json_to_pptx(
            json_data=request.json_data,
            style=request.style
        )
        return {"pptx_path": pptx_path}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

---

### é˜¶æ®µ4: åŠŸèƒ½æ•´åˆï¼ˆ1-2å¤©ï¼‰

#### 4.1 åˆ›å»ºç»¼åˆæœåŠ¡

åˆ›å»º `backend/services/integrated_service.py`ï¼š

```python
"""
ç»¼åˆæœåŠ¡
æ•´åˆè¯­éŸ³ã€PPTã€çŸ¥è¯†åº“ç­‰æ‰€æœ‰åŠŸèƒ½
"""
from backend.services.voice_service import get_voice_service
from backend.services.advanced_ppt_service import get_ppt_service
from backend.routes.chat_routes import chatService

class IntegratedService:
    """ç»¼åˆæœåŠ¡"""
    
    def __init__(self):
        self.voice_service = get_voice_service()
        self.ppt_service = get_ppt_service()
        self.chat_service = chatService
    
    def voice_to_ppt(
        self,
        audio_path: str,
        style: str = "modern"
    ) -> dict:
        """
        è¯­éŸ³è½¬PPT
        ç”¨æˆ·è¯´å‡ºPPTä¸»é¢˜ï¼Œè‡ªåŠ¨ç”ŸæˆPPT
        
        Args:
            audio_path: ç”¨æˆ·å½•éŸ³
            style: PPTæ ·å¼
        
        Returns:
            {
                "topic": "è¯†åˆ«çš„ä¸»é¢˜",
                "pptx_path": "ç”Ÿæˆçš„PPTè·¯å¾„"
            }
        """
        # 1. è¯­éŸ³è¯†åˆ«
        asr_result = self.voice_service.speech_to_text(audio_path)
        topic = asr_result["text"]
        
        # 2. ç”ŸæˆPPT
        ppt_result = self.ppt_service.create_ppt_from_topic(
            topic=topic,
            style=style
        )
        
        # 3. ç”Ÿæˆè¯­éŸ³ç¡®è®¤
        confirm_text = f"å·²ä¸ºæ‚¨ç”Ÿæˆå…³äº{topic}çš„æ¼”ç¤ºæ–‡ç¨¿"
        audio_confirm = self.voice_service.text_to_speech(confirm_text)
        
        return {
            "topic": topic,
            "pptx_path": ppt_result["pptx_path"],
            "audio_confirm": audio_confirm
        }
    
    def knowledge_to_ppt(
        self,
        query: str,
        style: str = "modern"
    ) -> dict:
        """
        çŸ¥è¯†åº“è½¬PPT
        åŸºäºçŸ¥è¯†åº“å†…å®¹ç”ŸæˆPPT
        
        Args:
            query: æŸ¥è¯¢å†…å®¹
            style: PPTæ ·å¼
        
        Returns:
            PPTç”Ÿæˆç»“æœ
        """
        # 1. æŸ¥è¯¢çŸ¥è¯†åº“
        response = self.chat_service.query(query, [])
        
        # 2. åŸºäºçŸ¥è¯†åº“å†…å®¹ç”ŸæˆPPT
        # TODO: å°†çŸ¥è¯†åº“å†…å®¹è½¬æ¢ä¸ºPPT JSONæ ¼å¼
        
        return {}
```

---

## ğŸ“Š å®Œæ•´åŠŸèƒ½æ¸…å•

### å·²å®ç°åŠŸèƒ½

| åŠŸèƒ½ | çŠ¶æ€ | æŠ€æœ¯ |
|------|------|------|
| æ–‡å­—å¯¹è¯ | å·²æœ‰ | çŸ¥è¯†åº“ + NPU |
| æ•°æ®åˆ†æ | å·²æœ‰ | pandas + DuckDB |
| å››è‰²å¡ç‰‡ | å·²æœ‰ | SQLite |
| Excelå¤„ç† | å·²æœ‰ | openpyxl |
| PDFå¤„ç† | å·²æœ‰ | pypdf |
| åŸºç¡€PPT | å·²æœ‰ | python-pptx |

### æ–°å¢åŠŸèƒ½

| åŠŸèƒ½ | çŠ¶æ€ | æŠ€æœ¯ |
|------|------|------|
| **è¯­éŸ³è¯†åˆ«** | ğŸ†• æ–°å¢ | Faster-Whisper |
| **è¯­éŸ³åˆæˆ** | ğŸ†• æ–°å¢ | Coqui TTS |
| **è¯­éŸ³å¯¹è¯** | ğŸ†• æ–°å¢ | Whisper + TTS |
| **é«˜çº§PPTç”Ÿæˆ** | ğŸ†• æ–°å¢ | pptx-generator |
| **æ™ºèƒ½PPTè§„åˆ’** | ğŸ†• æ–°å¢ | ppt-generator |
| **PPTè§†è§‰å¢å¼º** | ğŸ†• æ–°å¢ | nanobanana-ppt-visualizer |
| **è¯­éŸ³è½¬PPT** | ğŸ†• æ–°å¢ | ç»¼åˆæœåŠ¡ |
| **è¯­éŸ³è½¬æ–‡æ¡£** | ğŸ†• æ–°å¢ | Whisper + Markdown |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ–

åˆ›å»º `install_all_features.bat`ï¼š

```cmd
@echo off
echo ========================================
echo   Antinet å®Œæ•´åŠŸèƒ½å®‰è£…
echo ========================================
echo.

cd /d C:\test\antinet
call venv_arm64\Scripts\activate.bat

echo [1/4] å®‰è£…è¯­éŸ³åŠŸèƒ½ä¾èµ–...
pip install faster-whisper TTS

echo [2/4] å®‰è£…PPTåŠŸèƒ½ä¾èµ–...
pip install python-pptx pillow openpyxl python-dotenv

echo [3/4] å¤åˆ¶PPTæŠ€èƒ½...
call integrate_new_ppt_skills.bat

echo [4/4] æµ‹è¯•å®‰è£…...
python -c "import faster_whisper, TTS, pptx; print('All OK!')"

echo.
echo ========================================
echo   å®‰è£…å®Œæˆï¼
echo ========================================
pause
```

### æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

åˆ›å»º `test_all_features.py`ï¼š

```python
"""
æµ‹è¯•æ‰€æœ‰æ–°åŠŸèƒ½
"""
import sys
sys.path.insert(0, '.')

def test_voice():
    """æµ‹è¯•è¯­éŸ³åŠŸèƒ½"""
    print("\n=== æµ‹è¯•è¯­éŸ³åŠŸèƒ½ ===")
    from backend.services.voice_service import get_voice_service
    
    service = get_voice_service()
    
    # æµ‹è¯•TTS
    audio = service.text_to_speech("æµ‹è¯•è¯­éŸ³åˆæˆ")
    print(f"âœ“ TTSæµ‹è¯•é€šè¿‡: {audio}")

def test_ppt():
    """æµ‹è¯•PPTåŠŸèƒ½"""
    print("\n=== æµ‹è¯•PPTåŠŸèƒ½ ===")
    from backend.services.advanced_ppt_service import get_ppt_service
    
    service = get_ppt_service()
    
    # æµ‹è¯•PPTç”Ÿæˆ
    result = service.create_ppt_from_topic("æµ‹è¯•ä¸»é¢˜", pages=3)
    print(f"âœ“ PPTæµ‹è¯•é€šè¿‡: {result['pptx_path']}")

if __name__ == "__main__":
    try:
        test_voice()
        test_ppt()
        print("\nâœ“ æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼")
    except Exception as e:
        print(f"\nâœ— æµ‹è¯•å¤±è´¥: {e}")
```

---

##  APIç«¯ç‚¹æ€»è§ˆ

### è¯­éŸ³API

```
POST /api/voice/speech-to-text    # è¯­éŸ³è½¬æ–‡å­—
POST /api/voice/text-to-speech    # æ–‡å­—è½¬è¯­éŸ³
POST /api/voice/dialogue           # è¯­éŸ³å¯¹è¯
GET  /api/voice/health             # å¥åº·æ£€æŸ¥
```

### PPT API

```
POST /api/ppt/create-from-topic    # ä»ä¸»é¢˜åˆ›å»ºPPT
POST /api/ppt/json-to-pptx         # JSONè½¬PPTX
POST /api/ppt/enhance-visuals      # è§†è§‰å¢å¼º
```

### ç»¼åˆAPI

```
POST /api/integrated/voice-to-ppt      # è¯­éŸ³è½¬PPT
POST /api/integrated/knowledge-to-ppt  # çŸ¥è¯†åº“è½¬PPT
```

---

##  ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: è¯­éŸ³åŠ©æ‰‹

```python
# ç”¨æˆ·è¯´è¯
user_audio = "user_question.wav"

# è¯­éŸ³å¯¹è¯
result = voice_service.voice_dialogue(user_audio, chat_service)

# æ’­æ”¾å›ç­”
play_audio(result['assistant_audio'])
```

### åœºæ™¯2: å¿«é€Ÿç”ŸæˆPPT

```python
# ä»ä¸»é¢˜ç”Ÿæˆ
result = ppt_service.create_ppt_from_topic(
    topic="Antinetäº§å“ä»‹ç»",
    pages=10,
    style="modern"
)

# æ‰“å¼€PPT
open_file(result['pptx_path'])
```

### åœºæ™¯3: è¯­éŸ³è½¬PPT

```python
# ç”¨æˆ·è¯´å‡ºPPTä¸»é¢˜
user_audio = "recording.wav"

# è‡ªåŠ¨ç”ŸæˆPPT
result = integrated_service.voice_to_ppt(
    audio_path=user_audio,
    style="modern"
)

# è¿”å›PPT
return result['pptx_path']
```

---

## ğŸ‰ æ€»ç»“

### æ¨èæŠ€æœ¯æ ˆ

**Faster-Whisper** - è¯­éŸ³è¯†åˆ«  
**Coqui TTS** - è¯­éŸ³åˆæˆ  
**pptx-generator** - PPTæ–‡ä»¶ç”Ÿæˆ  
**ppt-generator** - PPTå†…å®¹è§„åˆ’  
**nanobanana-ppt-visualizer** - PPTè§†è§‰å¢å¼º  

### æ ¸å¿ƒä¼˜åŠ¿

1. å®Œå…¨æœ¬åœ°åŒ– - æ‰€æœ‰åŠŸèƒ½ç¦»çº¿è¿è¡Œ
2. æ·±åº¦é›†æˆ - ä¸ç°æœ‰çŸ¥è¯†åº“æ— ç¼å¯¹æ¥
3. åŠŸèƒ½ä¸°å¯Œ - è¯­éŸ³+PPT+çŸ¥è¯†åº“
4. æ€§èƒ½ä¼˜ç§€ - NPUåŠ é€Ÿ+ä¼˜åŒ–æ¨¡å‹
5. æ˜“äºæ‰©å±• - æ¨¡å—åŒ–è®¾è®¡

### ç«‹å³å¼€å§‹

```cmd
cd C:\test\antinet
install_all_features.bat
```

**å®Œæ•´çš„è¯­éŸ³+PPTåŠŸèƒ½é›†æˆæ–¹æ¡ˆå·²å‡†å¤‡å°±ç»ªï¼** ğŸš€

---

*é›†æˆæ–¹æ¡ˆåˆ›å»ºæ—¶é—´: 2026-01-26*  
*æ¨èæŠ€æœ¯æ ˆ: Faster-Whisper + Coqui TTS + PPTæŠ€èƒ½*  
*çŠ¶æ€: å‡†å¤‡å®æ–½*
