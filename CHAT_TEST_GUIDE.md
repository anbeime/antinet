#  对话AI功能测试指南

## 📋 测试前准备

### 1. 确保服务正在运行

```cmd
cd C:\test\antinet

# 如果服务未运行，启动它们
start_all.bat

# 等待服务启动（约10-15秒）
```

### 2. 验证服务状态

**后端服务**:
- 访问: http://localhost:8000
- 应该看到: `{"app":"Antinet智能知识管家",...}`

**前端服务**:
- 访问: http://localhost:3000
- 应该看到: Antinet 主页

---

## 🎯 测试步骤

### 步骤1: 打开对话AI

1. 访问 http://localhost:3000
2. 查看右下角，应该有一个**蓝紫色渐变的聊天机器人图标**
3. 点击图标，打开对话窗口

### 步骤2: 测试基础问答

输入以下问题，测试知识库功能：

#### 测试1: 系统概述
```
问题: Antinet是什么？
```

**预期回答**:
```
Antinet智能知识管家是一款部署于骁龙AIPC的端侧智能数据工作站...

📚 参考来源：
1. [事实] Antinet系统概述 (相似度: 95%)
```

#### 测试2: 功能查询
```
问题: Antinet有哪些核心功能？
```

**预期回答**:
```
Antinet的核心功能包括：
1. 自然语言驱动的数据查询
2. 自动数据分析与可视化
3. 四色卡片知识沉淀
...

📚 参考来源：
1. [事实] 核心价值 (相似度: 92%)
```

#### 测试3: 技术问题
```
问题: 为什么使用NPU？
```

**预期回答**:
```
使用NPU的原因：
- 性能: 推理速度提升4.2倍
- 功耗: NPU专用硬件，功耗降低60%
- 体验: 延迟<500ms，实时响应流畅

📚 参考来源：
1. [解释] 为什么使用NPU (相似度: 98%)
```

#### 测试4: 操作指南
```
问题: 如何启动服务？
```

**预期回答**:
```
启动Antinet服务的步骤：
1. 打开命令提示符
2. 进入项目目录: cd C:\test\antinet
3. 运行启动脚本: start_all.bat
...

📚 参考来源：
1. [行动] 如何启动服务 (相似度: 100%)
```

#### 测试5: 故障排查
```
问题: 遇到端口被占用怎么办？
```

**预期回答**:
```
端口被占用的解决方法：
1. 查找占用进程: netstat -ano | findstr :8000
2. 停止进程: taskkill /F /PID <进程ID>
3. 或使用停止脚本: stop_all.bat

📚 参考来源：
1. [风险] 端口被占用 (相似度: 95%)
2. [行动] 如何停止服务 (相似度: 85%)
```

---

## 成功标志

### 正确的响应特征

1. **有实质性回答** - 不是"模拟模式"或"后端未连接"
2. **有参考来源** - 显示 `📚 参考来源：` 和卡片列表
3. **有相似度** - 显示匹配度百分比
4. **有卡片类型** - 显示 [事实]/[解释]/[风险]/[行动]

### 示例正确响应

```
🤖 知识库助手

Antinet智能知识管家是一款部署于骁龙AIPC的端侧智能数据工作站，
通过集成NPU加速的轻量化大模型，实现自然语言驱动的数据查询、
自动数据分析与可视化、四色卡片知识沉淀等功能。

📚 参考来源：
1. [事实] Antinet系统概述 (相似度: 95%)
2. [解释] 端侧AI优势 (相似度: 87%)
3. [事实] 核心价值 (相似度: 82%)
```

---

## ❌ 错误标志

### 错误的响应特征

1. **显示"模拟模式"** - 说明还在使用CodeBuddy SDK
2. **显示"后端未连接"** - 说明后端服务未运行
3. **没有参考来源** - 说明知识库未被使用

### 示例错误响应

```
 后端服务未连接

当前使用模拟模式演示功能。

要启用完整知识库功能，请:
1. 打开命令行
2. 运行: start_backend.bat
3. 等待30-60秒服务启动
4. 刷新页面
```

**如果看到这个，说明修复未生效或后端未运行！**

---

## 🔧 故障排查

### 问题1: 仍然显示"模拟模式"

**检查步骤**:

1. **确认代码已修改**
   ```cmd
   # 检查 ChatBotModal.tsx 中的 useCodeBuddy 默认值
   # 应该是 false
   ```

2. **清除浏览器缓存**
   - 按 `Ctrl + Shift + R` 硬刷新
   - 或清除浏览器缓存后重新访问

3. **重启前端服务**
   ```cmd
   # 停止前端（Ctrl+C）
   # 重新启动
   pnpm run dev
   ```

### 问题2: 显示"后端未连接"

**检查步骤**:

1. **确认后端正在运行**
   ```cmd
   # 访问后端健康检查
   curl http://localhost:8000/api/health
   ```

2. **检查端口占用**
   ```cmd
   netstat -ano | findstr :8000
   ```

3. **重启后端服务**
   ```cmd
   cd C:\test\antinet
   start_backend.bat
   ```

### 问题3: 回答不准确或不相关

**原因**: 知识库内容有限（只有37张预设卡片）

**解决**: 这是正常的，预设知识库主要涵盖：
- 系统使用说明
- 技术架构
- 常见问题
- 操作指南

对于超出这些范围的问题，回答可能不够准确。

---

## 📊 测试结果记录

### 测试清单

- [ ] 打开对话窗口成功
- [ ] 测试1: 系统概述 - 回答正确
- [ ] 测试2: 功能查询 - 回答正确
- [ ] 测试3: 技术问题 - 回答正确
- [ ] 测试4: 操作指南 - 回答正确
- [ ] 测试5: 故障排查 - 回答正确
- [ ] 显示参考来源
- [ ] 显示相似度
- [ ] 显示卡片类型
- [ ] 对话历史保持

### 测试通过标准

- 至少4/5个测试问题回答正确
- 所有回答都有参考来源
- 相似度 > 80%
- 没有"模拟模式"或"后端未连接"错误

---

## 🎯 高级测试

### 测试对话上下文

```
第1轮: "Antinet是什么？"
第2轮: "它有哪些优势？"  （测试上下文理解）
第3轮: "如何使用？"      （测试连续对话）
```

### 测试卡片类型筛选

```
问题: "有哪些风险需要注意？"
预期: 应该返回黄色卡片（风险类）

问题: "我应该怎么做？"
预期: 应该返回红色卡片（行动类）
```

### 测试搜索功能

```
问题: "NPU"
预期: 返回所有与NPU相关的卡片

问题: "部署"
预期: 返回部署相关的卡片
```

---

##  测试报告模板

```
测试时间: 2026-01-26
测试人员: [您的名字]
环境: Windows 11 ARM64, venv_arm64

测试结果:
对话窗口打开正常
基础问答功能正常
知识库读取正常
参考来源显示正常
 部分问题回答不够准确（知识库覆盖有限）

总体评价: 通过 ✅
建议: 扩展知识库内容以提高回答准确度
```

---

## 🚀 下一步

测试通过后，可以：

1. **扩展知识库**
   - 编辑 `backend/routes/chat_routes.py`
   - 添加更多预设卡片

2. **实现向量检索**
   - 集成向量数据库（如 ChromaDB）
   - 实现语义搜索

3. **优化回答质量**
   - 调整相似度阈值
   - 优化prompt模板

**现在开始测试吧！** 

---

*测试指南创建时间: 2026-01-26*  
*状态: 准备就绪*
