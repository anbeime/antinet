# çŸ¥è¯†åº“å¯¹è¯æœºå™¨äººé›†æˆè¯´æ˜

## æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°å°†å‰ç«¯çš„å¯¹è¯æœºå™¨äººä¸åç«¯çŸ¥è¯†åº“æ•°æ®åº“è¿›è¡Œäº†å¯¹æ¥ï¼Œå®ç°äº†åŸºäºå››è‰²å¡ç‰‡ï¼ˆäº‹å®/è§£é‡Š/é£é™©/è¡ŒåŠ¨ï¼‰çš„çŸ¥è¯†åº“æŸ¥è¯¢åŠŸèƒ½ã€‚

## æ¶æ„

### åç«¯

#### 1. æ–°å¢è·¯ç”±æ–‡ä»¶
- **`backend/routes/chat_routes.py`**: çŸ¥è¯†åº“èŠå¤©APIè·¯ç”±
  - `/api/chat/query`: çŸ¥è¯†åº“æŸ¥è¯¢æ¥å£
  - `/api/chat/search`: å¡ç‰‡æœç´¢æ¥å£
  - `/api/chat/cards`: åˆ—å‡ºçŸ¥è¯†å¡ç‰‡
  - `/api/chat/card/{card_id}`: è·å–å•ä¸ªå¡ç‰‡è¯¦æƒ…
  - `/api/chat/health`: å¥åº·æ£€æŸ¥

#### 2. ä¸»åº”ç”¨æ›´æ–°
- **`backend/main.py`**: æ³¨å†Œäº†æ–°çš„chat_routerè·¯ç”±
- ä½¿ç”¨`data-analysis-iteration`ç›®å½•ä¸‹çš„`DatabaseManager`è¿›è¡ŒçŸ¥è¯†åº“ç®¡ç†

### å‰ç«¯

#### 1. æ–°å¢æœåŠ¡æ–‡ä»¶
- **`src/services/chatService.ts`**: çŸ¥è¯†åº“èŠå¤©æœåŠ¡
  - `query()`: çŸ¥è¯†åº“æŸ¥è¯¢
  - `searchCards()`: æœç´¢çŸ¥è¯†å¡ç‰‡
  - `listCards()`: åˆ—å‡ºå¡ç‰‡
  - `getCard()`: è·å–å¡ç‰‡è¯¦æƒ…
  - `healthCheck()`: å¥åº·æ£€æŸ¥

#### 2. æ›´æ–°ç»„ä»¶
- **`src/components/ChatBotModal.tsx`**: å¯¹è¯æœºå™¨äººç»„ä»¶
  - ä½¿ç”¨çŸ¥è¯†åº“APIæ›¿ä»£åŸæ¥çš„GenieAPIService
  - æ˜¾ç¤ºçŸ¥è¯†æ¥æºï¼ˆç›¸å…³å¡ç‰‡ï¼‰
  - æ˜¾ç¤ºç›¸ä¼¼åº¦åˆ†æ•°

## æŠ€æœ¯å®ç°

### å‘é‡æ£€ç´¢
- ä½¿ç”¨`MemoryAgent._generate_query_embedding()`ç”ŸæˆæŸ¥è¯¢å‘é‡
- é€šè¿‡`DatabaseManager.vector_search()`è¿›è¡Œå‘é‡æ£€ç´¢
- æ”¯æŒBGE-M3æ¨¡å‹ï¼ˆå¦‚æœå·²å®‰è£…`sentence-transformers`ï¼‰

### å›å¤ç”Ÿæˆ
- åŸºäºæ£€ç´¢åˆ°çš„å››è‰²å¡ç‰‡ç”Ÿæˆå›å¤
- æŒ‰å¡ç‰‡ç±»å‹åˆ†ç±»æ˜¾ç¤ºï¼š
  - ğŸ“Š äº‹å®ï¼ˆè“è‰²ï¼‰
  - ğŸ’¡ è§£é‡Šï¼ˆç»¿è‰²ï¼‰
  - âš ï¸ é£é™©ï¼ˆé»„è‰²ï¼‰
  - ğŸ¯ è¡ŒåŠ¨å»ºè®®ï¼ˆçº¢è‰²ï¼‰

### æ•°æ®åº“ç»“æ„
- SQLiteçŸ¥è¯†åº“ï¼š`data-analysis-iteration/data/knowledge.db`
- DuckDBåˆ†æåº“ï¼š`data-analysis-iteration/data/analysis.db`

## APIç«¯ç‚¹

### POST /api/chat/query
**è¯·æ±‚ä½“**:
```json
{
  "query": "ä»€ä¹ˆæ˜¯é£é™©ç­‰çº§ï¼Ÿ",
  "conversation_history": [],
  "context": {}
}
```

**å“åº”**:
```json
{
  "response": "ğŸ“Š **ç›¸å…³äº‹å®ï¼š**\n...",
  "sources": [
    {
      "card_id": "card_001",
      "card_type": "yellow",
      "title": "é£é™©è¯„ä¼°æ ‡å‡†",
      "similarity": 0.8765
    }
  ],
  "cards": [...]
}
```

### POST /api/chat/search
**è¯·æ±‚ä½“**:
```json
{
  "query": "é£é™©",
  "card_type": "yellow",
  "limit": 10
}
```

**å“åº”**:
```json
{
  "cards": [...],
  "total": 5
}
```

### GET /api/chat/cards
**æŸ¥è¯¢å‚æ•°**:
- `card_type`: å¡ç‰‡ç±»å‹è¿‡æ»¤ï¼ˆå¯é€‰ï¼‰
- `limit`: è¿”å›æ•°é‡é™åˆ¶ï¼ˆé»˜è®¤50ï¼‰
- `offset`: åç§»é‡ï¼ˆé»˜è®¤0ï¼‰

**å“åº”**:
```json
{
  "cards": [...],
  "total": 42
}
```

### GET /api/chat/card/{card_id}
**å“åº”**: å¡ç‰‡è¯¦æƒ…å¯¹è±¡

### GET /api/chat/health
**å“åº”**:
```json
{
  "status": "healthy",
  "database_initialized": true
}
```

## ä½¿ç”¨è¯´æ˜

### å¯åŠ¨åç«¯æœåŠ¡
```bash
cd backend
python main.py
```

### å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
cd frontend
npm run dev
```

### æµ‹è¯•API
```bash
python test_chat_api.py
```

### ä½¿ç”¨å¯¹è¯æœºå™¨äºº
1. æ‰“å¼€å‰ç«¯åº”ç”¨
2. ç‚¹å‡»å¯¹è¯æœºå™¨äººå›¾æ ‡
3. è¾“å…¥é—®é¢˜ï¼Œä¾‹å¦‚ï¼š
   - "ä»€ä¹ˆæ˜¯é£é™©ç­‰çº§ï¼Ÿ"
   - "å¦‚ä½•è¿›è¡Œæ•°æ®åˆ†æï¼Ÿ"
   - "æœ‰å“ªäº›è¡ŒåŠ¨å»ºè®®ï¼Ÿ"
4. ç³»ç»Ÿä¼šåŸºäºçŸ¥è¯†åº“è¿”å›ç›¸å…³å¡ç‰‡ä¿¡æ¯

## å‰ç«¯ç•Œé¢æ›´æ–°

### å¯¹è¯æœºå™¨äººæ ‡é¢˜
- æ—§ï¼šAntinet ä½¿ç”¨ç­”ç–‘åŠ©æ‰‹
- æ–°ï¼šAntinet çŸ¥è¯†åº“åŠ©æ‰‹

### æ¶ˆæ¯æ˜¾ç¤º
- å›å¤æ¶ˆæ¯ä¼šæ˜¾ç¤ºçŸ¥è¯†æ¥æº
- æ˜¾ç¤ºç›¸å…³å¡ç‰‡ç±»å‹å’Œç›¸ä¼¼åº¦
- ä½¿ç”¨å›¾æ ‡åŒºåˆ†ä¸åŒç±»å‹çš„å¡ç‰‡ï¼š
  - è“è‰²ï¼ˆäº‹å®ï¼‰ï¼šInfoå›¾æ ‡
  - ç»¿è‰²ï¼ˆè§£é‡Šï¼‰ï¼šFileTextå›¾æ ‡
  - é»„è‰²ï¼ˆé£é™©ï¼‰ï¼šAlertTriangleå›¾æ ‡
  - çº¢è‰²ï¼ˆè¡ŒåŠ¨ï¼‰ï¼šCheckCircleå›¾æ ‡

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“åˆå§‹åŒ–**
   - çŸ¥è¯†åº“æ•°æ®åº“éœ€è¦åœ¨`data-analysis-iteration/data/`ç›®å½•ä¸‹
   - å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œ`DatabaseManager`ä¼šè‡ªåŠ¨åˆ›å»º

2. **å‘é‡åŒ–æ¨¡å‹**
   - æ¨èå®‰è£…`sentence-transformers`ä»¥ä½¿ç”¨BGE-M3æ¨¡å‹
   - å¦‚æœæœªå®‰è£…ï¼Œä¼šä½¿ç”¨ç®€åŒ–çš„å“ˆå¸Œå‘é‡æ–¹æ³•

3. **CORSé…ç½®**
   - åç«¯å·²é…ç½®CORSï¼Œå…è®¸æ¥è‡ª`localhost:3000`çš„è¯·æ±‚

4. **é”™è¯¯å¤„ç†**
   - å‰ç«¯ä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œå¹¶æç¤ºä¿®å¤æ­¥éª¤
   - åç«¯ä¼šè®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

## æ–‡ä»¶æ¸…å•

### åç«¯æ–°å¢/ä¿®æ”¹
- âœ… `backend/routes/chat_routes.py` (æ–°å»º)
- âœ… `backend/main.py` (ä¿®æ”¹)

### å‰ç«¯æ–°å¢/ä¿®æ”¹
- âœ… `src/services/chatService.ts` (æ–°å»º)
- âœ… `src/components/ChatBotModal.tsx` (ä¿®æ”¹)

### æµ‹è¯•æ–‡ä»¶
- âœ… `test_chat_api.py` (æ–°å»º)

## æœªæ¥æ”¹è¿›

1. æ·»åŠ å¡ç‰‡åˆ›å»º/æ›´æ–°/åˆ é™¤åŠŸèƒ½
2. æ”¯æŒæ›´å¤æ‚çš„è‡ªç„¶è¯­è¨€ç†è§£
3. æ·»åŠ å¯¹è¯å†å²ç®¡ç†
4. æ”¯æŒå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡
5. æ·»åŠ å¡ç‰‡å…³è”å…³ç³»å¯è§†åŒ–
6. æ”¯æŒçŸ¥è¯†åº“æ•°æ®å¯¼å…¥/å¯¼å‡º
