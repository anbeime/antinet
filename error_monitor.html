<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®æ—¶é”™è¯¯æ•è·</title>
    <style>
        body {
            font-family: 'Consolas', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .error-box {
            background: #3c1f1f;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .warning-box {
            background: #3d3416;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .info-box {
            background: #1f3c3c;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success-box {
            background: #1f3c1f;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        pre {
            background: #252526;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .timestamp {
            color: #858585;
            font-size: 12px;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1177bb;
        }
        #iframe-container {
            margin-top: 20px;
            border: 2px solid #444;
            border-radius: 4px;
            overflow: hidden;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
            background: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Antinet å‰ç«¯å®æ—¶é”™è¯¯ç›‘æ§</h1>
    
    <div class="info-box">
        <strong>ç›‘æ§è¯´æ˜ï¼š</strong>
        <ul>
            <li>æ­¤é¡µé¢ä¼šåœ¨iframeä¸­åŠ è½½å‰ç«¯åº”ç”¨</li>
            <li>æ•è·æ‰€æœ‰JavaScripté”™è¯¯å’Œè­¦å‘Š</li>
            <li>æ˜¾ç¤ºç½‘ç»œè¯·æ±‚å¤±è´¥</li>
            <li>ç›‘æ§Reactæ¸²æŸ“é”™è¯¯</li>
        </ul>
    </div>

    <div>
        <button onclick="loadApp()">åŠ è½½å‰ç«¯åº”ç”¨</button>
        <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        <button onclick="testAPI()">æµ‹è¯•API</button>
    </div>

    <h2>ğŸ“‹ é”™è¯¯æ—¥å¿—</h2>
    <div id="logs"></div>

    <h2>ğŸ–¥ï¸ å‰ç«¯åº”ç”¨é¢„è§ˆ</h2>
    <div id="iframe-container">
        <p style="padding: 20px; color: #888;">ç‚¹å‡»"åŠ è½½å‰ç«¯åº”ç”¨"æŒ‰é’®å¼€å§‹...</p>
    </div>

    <script>
        const logsDiv = document.getElementById('logs');
        let errorCount = 0;
        let warningCount = 0;

        function addLog(type, message, details = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.createElement('div');
            logDiv.className = type + '-box';
            
            let icon = 'ğŸ“';
            if (type === 'error') {
                icon = 'âŒ';
                errorCount++;
            } else if (type === 'warning') {
                icon = 'âš ï¸';
                warningCount++;
            } else if (type === 'success') {
                icon = 'âœ…';
            }
            
            logDiv.innerHTML = `
                <div>
                    <strong>${icon} ${type.toUpperCase()}</strong>
                    <span class="timestamp">${timestamp}</span>
                </div>
                <div style="margin-top: 5px;">${message}</div>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            
            logsDiv.insertBefore(logDiv, logsDiv.firstChild);
            
            // æ›´æ–°æ ‡é¢˜æ˜¾ç¤ºé”™è¯¯æ•°
            document.title = `é”™è¯¯:${errorCount} è­¦å‘Š:${warningCount} - å®æ—¶ç›‘æ§`;
        }

        function clearLogs() {
            logsDiv.innerHTML = '';
            errorCount = 0;
            warningCount = 0;
            document.title = 'å®æ—¶é”™è¯¯æ•è·';
            addLog('info', 'æ—¥å¿—å·²æ¸…é™¤');
        }

        async function testAPI() {
            addLog('info', 'å¼€å§‹æµ‹è¯•API...');
            
            try {
                const response = await fetch('http://localhost:8000/api/knowledge/cards');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                addLog('success', `APIæµ‹è¯•æˆåŠŸï¼Œè·å–åˆ° ${data.length} æ¡æ•°æ®`, 
                    `ç¬¬ä¸€æ¡æ•°æ®:\n${JSON.stringify(data[0], null, 2)}`);
                
                // æ£€æŸ¥æ•°æ®æ ¼å¼
                const firstCard = data[0];
                const issues = [];
                if (!firstCard.card_type) issues.push('ç¼ºå°‘ card_type å­—æ®µ');
                if (!firstCard.title) issues.push('ç¼ºå°‘ title å­—æ®µ');
                if (!firstCard.content) issues.push('ç¼ºå°‘ content å­—æ®µ');
                
                if (issues.length > 0) {
                    addLog('warning', 'æ•°æ®æ ¼å¼é—®é¢˜', issues.join('\n'));
                } else {
                    addLog('success', 'æ•°æ®æ ¼å¼æ­£ç¡®');
                }
                
            } catch (error) {
                addLog('error', 'APIæµ‹è¯•å¤±è´¥', error.message);
            }
        }

        function loadApp() {
            const container = document.getElementById('iframe-container');
            container.innerHTML = '<iframe src="http://localhost:3000"></iframe>';
            addLog('info', 'æ­£åœ¨åŠ è½½å‰ç«¯åº”ç”¨...');
            
            // ç›‘å¬iframeåŠ è½½
            const iframe = container.querySelector('iframe');
            iframe.onload = () => {
                addLog('success', 'å‰ç«¯åº”ç”¨åŠ è½½å®Œæˆ');
                
                // å°è¯•è®¿é—®iframeå†…å®¹ï¼ˆå¯èƒ½å› è·¨åŸŸé™åˆ¶å¤±è´¥ï¼‰
                try {
                    const iframeWindow = iframe.contentWindow;
                    
                    // æ•è·iframeä¸­çš„é”™è¯¯
                    iframeWindow.addEventListener('error', (event) => {
                        addLog('error', 'iframeé”™è¯¯', 
                            `æ–‡ä»¶: ${event.filename}\nè¡Œå·: ${event.lineno}\næ¶ˆæ¯: ${event.message}`);
                    });
                    
                    // æ•è·æœªå¤„ç†çš„Promiseæ‹’ç»
                    iframeWindow.addEventListener('unhandledrejection', (event) => {
                        addLog('error', 'Promiseæ‹’ç»', event.reason);
                    });
                    
                    addLog('success', 'å·²å¯ç”¨iframeé”™è¯¯ç›‘æ§');
                } catch (e) {
                    addLog('warning', 'æ— æ³•ç›‘æ§iframeå†…éƒ¨ï¼ˆè·¨åŸŸé™åˆ¶ï¼‰', 
                        'è¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯');
                }
            };
            
            iframe.onerror = () => {
                addLog('error', 'å‰ç«¯åº”ç”¨åŠ è½½å¤±è´¥', 'è¯·ç¡®ä¿å‰ç«¯æœåŠ¡è¿è¡Œåœ¨ http://localhost:3000');
            };
        }

        // å…¨å±€é”™è¯¯æ•è·
        window.addEventListener('error', (event) => {
            addLog('error', 'å…¨å±€é”™è¯¯', 
                `æ–‡ä»¶: ${event.filename}\nè¡Œå·: ${event.lineno}\næ¶ˆæ¯: ${event.message}`);
        });

        window.addEventListener('unhandledrejection', (event) => {
            addLog('error', 'Promiseæ‹’ç»', event.reason);
        });

        // åˆå§‹åŒ–
        addLog('info', 'é”™è¯¯ç›‘æ§å·²å¯åŠ¨');
        addLog('info', 'å‰ç«¯åœ°å€: http://localhost:3000');
        addLog('info', 'åç«¯åœ°å€: http://localhost:8000');
    </script>
</body>
</html>
